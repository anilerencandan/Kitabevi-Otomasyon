<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Document</title>
    </head>
<body class="bg-dark">

<style>
  .full-screen {
      position: fixed; /* Sabit pozisyon */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999; /* İhtiyaca bağlı olarak */
      /* Arkaplan rengi ve şeffaflık */

  }

  .bg-dark {
    background-color: #343a40 !important;
  }

  .bg-dark-2{
    background-color: black !important;
  }

  .line{
    border-color: rgb(86, 86, 86) !important;
  }

  .content {
       /* İstediğiniz genişlik */
      height: 100%; /* İçeriğin boyutuna göre yükseklik ayarı */
      padding: 20px; /* İçerik iç boşluğu */
      overflow-y: auto;
  }
  
  body{
    overflow-x: hidden;
  }
</style>

<div class="row" >
  <div class="col-2 p-0">
    <div class="content p-4 d-flex flex-column flex-shrink-0 p-0 text-bg-dark col-2 border line" id="sideBar" style="width: 100%; height: 100vh;" >
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
        <svg class="bi pe-none " width="40" height="32"><use xlink:href="#bootstrap"></use></svg>
        <span class="fs-4">Sago Kitapevi</span>
      </a>
      <hr>
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="/members" class="nav-link text-white  " aria-current="page">
            <svg class="bi pe-none me-2 " width="16" height="16"><use xlink:href="#home"></use></svg>
            Üyeler
          </a>
        </li>
        <li>
          <a href="/books" class="nav-link text-white  ">
            <svg class="bi pe-none me-2" width="16" height="16"><use xlink:href="#speedometer2"></use></svg>
            Kitaplar
          </a>
        </li>
        <li>
          <a href="/orders" class="nav-link text-white ">
            <svg class="bi pe-none me-2" width="16" height="16"><use xlink:href="#table"></use></svg>
            Siparişler
          </a>
        </li>
      </ul>
      <hr>
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
          <strong>
          </strong>
        </a>
        <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
          <li><a class="dropdown-item" href="/profile">Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" onclick="logOut()" href="#">Sign out</a></li>
        </ul>
      </div>
    </div>
</div>
  <div class="col-10 p-0 ps-2 pt-2 pe-4">
    <div class="row">
        <div class="col-12 d-flex justify-content-between ">
          <div>
            <h1 class="text-white ">Profil</h1>
          </div>
        </div>
    </div>
    <hr class="border border-line"> 
    <div class="container">
      <div class="row d-flex ">
        <div class="col-4 text-white" style="width: 20em;">
          <h3>Adi</h3>
          <div class="mb-3" >
            <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" value="" name="adi">
            <button type="button" class="btn btn-primary mt-4">Kaydet</button>
          </div>
        </div>
        <div class="col-4 text-white">
          <h3>Soyadi</h3>
          <div class="mb-3">
            <input type="email" class="form-control" style="width: 20em;" id="exampleInputEmail1" aria-describedby="emailHelp" value="" name="soyadi">
          </div>
        </div>
        <div class="col-4">
          <!-- User Info Toast Message Start -->
          <div class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true" id="userInfoToastContainer">
            <div class="d-flex">
              <div class="toast-body">
                Şifreniz başarıyla değiştirildi.
              </div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
          <!-- User Info Toast Message End -->
        </div>
      </div>
      
    </div>
    <hr class="border border-line">
    <div class="container ">
      <div class="row d-flex ">
        <!-- sifre guncelleme -->
        <div class="col-6 text-white" style="width: 20em;">
          <h3>Şifre Değiştirme</h3>
          <div class="mb-3">
            <input type="password" class="form-control mt-4" id="newPassword" placeholder="Yeni şifre" name="newPassword">
            <input type="password" class="form-control mt-4" id="confirmPassword" placeholder="Yeni şifre tekrar" name="confirmPassword">
            <button type="button" class="btn btn-primary mt-4" id="changePassword">Şifreyi Değiştir</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Password Toast Message Start -->
    <div class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true" id="passToastContainer">
      <div class="d-flex">
        <div class="toast-body">
          Şifreniz başarıyla değiştirildi.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
    <!-- Password Toast Message End -->

    <hr class="border border-line">
    
    <div class="container text-white">
      <h1>Hesabı Sil</h1>
      <p>Emin misiniz? Hesabınızı silmek istediğinize emin misiniz?</p>
      <button id="silButton" class="btn btn-danger ">Hesabı Sil</button>
  </div>
  
  <!-- Modal -->
  <div class="modal fade" id="sorguModal" tabindex="-1" aria-labelledby="sorguModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="sorguModalLabel">Hesap Silme Onayı</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  Silmek istediğinize emin misiniz?
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal">İptal</button>
                  <script>
                    function deleteAccount() {
                      fetch('/deleteAccount')
                          .then(response => {
                              if (response.redirected) { 
                                  // Yönlendirme durumu, işlem başarılı olduğunu gösterir
                                  Console.log('Hesabınız başarıyla silindi.');
                              } else {
                                  // Başarısız durum, uygun bir hata mesajı gösterilebilir
                                  alert('Hesap silinemedi. Lütfen tekrar deneyin.');
                              }
                          })
                          .catch(error => {
                              // İşlem sırasında bir hata oluşursa
                              console.error('Bir hata oluştu:', error);
                              alert('Bir hata oluştu. Lütfen tekrar deneyin.');
                          });
                  }
                  </script>
                  <button id="silOnayButton" type="button" class="btn btn-danger" onclick="deleteAccount()">Evet, Sil</button>
              </div>
          </div>
      </div>
  </div>
    
  </div>
</div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    
    

    document.addEventListener('DOMContentLoaded', function () {
      // Şifreyi değiştir butonuna tıklandığında
      document.getElementById('changePassword').addEventListener('click', function () {
        var newPassword = document.getElementById('newPassword').value;
        var confirmPassword = document.getElementById('confirmPassword').value;
        
        // Eğer yeni şifre ve tekrar edilen şifre aynı değilse
        if(newPassword === '' || confirmPassword === '') {
          alert('Şifre alanları boş bırakılamaz!');
          return;
        } 
        else if (newPassword !== confirmPassword) {
          alert('Yeni şifreler uyuşmuyor!');
          return;
        }
        fetch('/updatePassword', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ newPassword, confirmPassword }),
        }).then(response => {
          if (response.ok) {
            showToast(1);
          }
        });
        // Simüle edilmiş bir sorgu, gerçekleşmiş gibi 2 saniye bekletiyoruz
      });
      
      // Toast mesajını gösteren fonksiyon
      
      function showToast(num) {
        if(num === 1){
          var toastElement = document.getElementById('passToastContainer');
          var toast = new bootstrap.Toast(toastElement);
          toast.show();
        }else if(num === 1){
          var toastElement = document.getElementById('userInfoToastContainer');
          var toast = new bootstrap.Toast(toastElement);
          toast.show();
        }
        
      }
    });

    
    document.getElementById("silButton").addEventListener("click", function() {
      $('#sorguModal').modal('show'); // Modalı göster
    });
  
  document.getElementById("silOnayButton").addEventListener("click", function() {
      // Buraya hesabı silme işlemini gerçekleştiren kodu yazabilirsiniz
      alert("Hesabınız başarıyla silindi.");
      $('#sorguModal').modal('hide'); // Modalı gizle
    });
  </script>
  <script>
    function logOut(){
      fetch('/logout')
      .then(response => {
        if(response.redirected){
          window.location.href = response.url;
        }
      });
    }
  </script>
  <script>  
    fetchUserInfo();
    document.querySelector('button').addEventListener('click', updateuser);
    function updateuser(){
      const adi = document.querySelector('input[name="adi"]').value;
      const soyadi = document.querySelector('input[name="soyadi"]').value;

      fetch('/updateUser', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ adi, soyadi}),
      }).then(response => {
        if (response.ok) {
          showToast(0);
        }
      });
      
    }

    function fetchUserInfo(){
      fetch('/userInfo')
      .then(response => response.json())
      .then(data => {
        document.querySelector('input[name="adi"]').value = data.uye_adi;
        document.querySelector('input[name="soyadi"]').value = data.uye_soyadi;
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>